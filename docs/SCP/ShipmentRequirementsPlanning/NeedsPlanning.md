# Планирование потребностей

Для настройки АРМа **"Планирование потребностей"** заполняется [**"Сценарий планирования потребностей"**](NeedsPlanningScenarios.md), автоматически заполнятся период и настройки:

[![1][1]][1]

Вкладка **"Отгрузки"** будет заполнена товарами, в которых есть потребность на выбранный период и отвечающими настройкам.

Номенклатуры можно детализировать в табличной части до характеристики, склада, волны и даты выпуска. Также для каждой номенклатуры будет выведен артикул.  

Дата выпуска - это минимально рекомендованная дата выпуска продукции с учетом срока годности номенклатуры и %ОСГ.

> Дата выпуска вычисляется по формуле: Дата выпуска = Дата отгрузки - Срок годности + Сдвиг даты

Дата отгрузки - планируемая дата отгрузки, указанная в Заказе/Пред Заказе.

Срок годности - количество дней, указанных в карточке номенклатуры.

Сдвиг даты = округлить(Срок годности * (%ОСГ/100)). Это сдвиг вправо от минимально возможной даты изготовления продукции, до этого дня нельзя отгружать продукцию.

%ОСГ подставляется следующим образом:

- если в Заказе/Пред заказе/Прогнозе/Акционной отгрузке указана точка доставки, то %ОСГ берется из регистра "Разрешенные ОСГ товаров" по номенклатуре и ТД;
- если не указана ТД или не указан %ОСГ по ТД, то берется общий %ОСГ из контрагента;
- если %ОСГ не указан ни по ТД, ни по контрагенту, то %ОСГ берется по умолчанию из Сценария планирования потребностей.

Например: Дата отгрузки - 31.03; Срок годности - 15 дней; %ОСГ - 90%.

Тогда Сдвиг даты = 15 * 0,9 = 13,5. Округление до 14. Затем Дата выпуска = 31.03 - 15 + 14 = 30.03

 Для каждой номенклатуры будут заполнены поля:

- Пр-з отгрузки – заполняются на основании документов **"Планы отгрузки"**
- Прогноз – заполняются на основании документов **"Прогноз. Выполнение расчета"**, модели по которым производится расчет хранятся в регистре [**"Правила расчета отгрузок"**](RulesForCalculatingShipments.md) (номенклатуры, выведенные из ассортимента, не учитываются):

    - По заказам
    - По статистике
    - По статистике с вытеснением заказами

- Пред. заказы – заполняются на основании документов **"Предварительные заказы"**
- Заказы – заполняются на основании документов **"Заказы клиентов"** (заказы в состоянии "Закрыт" не учитываются)

[![2][2]][2]

Заполнить план потребностей можно несколькими способами, выбрав из выпадающего списка **"Сделать"** один из вариантов:

- Заполнить план по правилу – план заполняется по правилу расчета отгрузок
- Заполнить план по сохраненному плану
- Заполнить план по прогнозу отгрузки
- Заполнить план по прогнозу
- Заполнить план по предварительным заказам
- Заполнить план по заказам

Либо можно изменить план вручную:

- Изменить план на процент
- Округлить план до кратности
- Установить конкретное значение

После выбора варианта заполнения нужно выбрать строки для заполнения, а затем нажать кнопку **"Выполнить"**, будет заполнена колонка **"План"** в таблице. Если в карточке номенклатуры была указана кратность, а число в колонке "План" в результате вытеснения данных рассчитывается не кратным, то оно всегда округляется по кратности номенклатуры в большую сторону. 

[![3][3]][3]

У колонок Заказ, Пред. заказ и Прогноз реализовано вытеснение данных по приоритету: Заказ вытесняет Пред. заказ, Пред. заказ вытесняет Прогноз (также Заказ вытесняет и Прогноз). Это вытеснение происходит в разрезе одной точки доставки, т. е. колонки по остальным точкам доставки не вытесняются Заказом и Пред. заказом от другой точки доставки и попадают в план потребностей.

После заполнения колонки **"План"**, на вкладке **"Расчет"** показана полная статистика по планируемым отгрузкам. Указаны нечисловые данные: период отгрузки, волна, номенклатура, характеристика, базовый продукт, сезоннаяя группа, склад, правило, по которому рассчитывалось число отгрузки. Указаны также числовые данные, которые перенеслись из вкладки **"Отгрузки"**.

[![4][4]][4]

Для формирования плана потребностей нужно нажать кнопку **"Сохранить"**, система подставит его в поле "Сохраненный план". Если меняем уже существующий, то также нажимаем кнопку **"Сохранить"**.

В результате сформируется документ **"План потребностей"** на указанный период.

[![5][5]][5]

"Планы потребностей" также могут вытеснять друг друга по следующей логике:

- например, был создан План потребностей 1 на периодс 1.01 по 10.01 по Сценарию 1 по Товарной категории 1
- далее был создан План потребностей 2 на периодс 6.01 по 12.01 по Сценарию 2 по Товарной категории 1
- товарная категория в этих документах одинаковая, поэтому второй документ вытеснит первый по отгрузкам в периоде с 6.01 по 10.01 по Товарной категории 1

Вытеснение означает, что новый созданный документ "План потребностей" по товарной категории будет приоритетнее предыдущего по этой же товарной категории. А совпадающие значения по дате отгрузки предыдущего документа перестают быть активными. Вытеснение идет по дате потребности и товарной категории.

[1]: NeedsPlanning.assets/1.png
[2]: NeedsPlanning.assets/2.png
[3]: NeedsPlanning.assets/3.png
[4]: NeedsPlanning.assets/4.png
[5]: NeedsPlanning.assets/5.png
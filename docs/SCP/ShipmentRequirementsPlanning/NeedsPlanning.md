# Планирование потребностей

АРМ **"Планирование потребностей"** расположен в подсистеме **"Планирование"**.

[![1][1]][1]

Для настройки АРМа **"Планирование потребностей"** заполняется [**"Сценарий планирования потребностей"**](NeedsPlanningScenarios.md), при выборе которого автоматически заполнятся период планирования и настройки:

[![2][2]][2]

После обновления на вкладке **"Отгрузки"** будет отражена потребность в отгрузке за выбранный период. Данные выводятся в разрезе номенклатуры, характеристики, склада, волны отгрузки и даты выпуска. Детализацию до характеристики, склада и волны можно отключить в [**сценарии планирования потребностей**](NeedsPlanningScenarios.md) или настройках АРМа.

[![3][3]][3]

--------------------------------  

Дата выпуска - это минимально рекомендованная дата выпуска продукции, рассчитанная на основании срока годности этой продукции и процент разрешенного остаточного срока годности.

Дата выпуска вычисляется по формуле: `Дата выпуска = Дата отгрузки - (Срок годности - Сдвиг срока годности)`, где:

- Дата отгрузки – дата отгрузки, указанная в заказе клиента или предварительном заказе;

- Срок годности – срок годности продукции, указанный в карточке номенклатуры;

- Сдвиг срока годности = Срок годности * (Разрешенный процент ОСГ / 100) - максимальный сдвиг срока годности для изготовления продукции, подходящей под остаточный срок годности клиента. 

`Например:`

`Дата отгрузки - 31.03; срок годности - 15 дней; % ОСГ - 90%.`

`Тогда сдвиг даты будет равен 15 * 0,9 = 13,5, затем округлен до 14. Итоговая дата выпуска будет равна 31.03 - 1 день (15 - 14), получаем 30.03.`

Процент разрешенного остаточного срока годности для расчета *даты выпуска* подбирается следующим образом:

- Система проверяет есть ли данные в регистре **"Разрешенный остаточный срок годности товаров"** для указанной в заказе/предварительном заказе/прогнозе точки доставки и номенклатуры;
- Если в регистре **"Разрешенный остаточный срок годности товаров"** отсутствуют данные для указанной точки доставки и номенклатуры, то проверяется разрешенный процент ОСГ в карточке контрагента;
- Если процент ОСГ не установлен ни в регистре, ни в контрагенте, либо равен нулю, то процент разрешенного остаточного срока годности будет равен ОСГ по умолчанию из [**"Сценария планирования потребностей"**](NeedsPlanningScenarios.md).

--------------------------------  

Потребность в отгрузке за выбранный период выводится в разрезе трех компонент:

- **Прогноз** – это статистика продаж за прошлые периоды, очищенная от акционных приростов прошлого периода и учитывающая приросты по акциям в текущем периоде;

- **Предварительные заказы** – это плановый объем по заказам из документа **"Предварительный заказ"**;

- **Заказы** – это фактический объем по заказам из документа **"Заказ клиента"**, при расчете не учитываются заказы в состоянии "Закрыт". Данные по объему берутся из исходного количества в заказе.

[![4][4]][4]

Прогноз отгрузки содержит в себе справочную информации из документа **"Прогноз отгрузок"**, с которой можно сравнить получившийся в результате план.

-------------------------------- 

***Алгоритм расчета прогноза на дату отгрузки:***

**Прогноз** в АРМе «Планирование потребностей» - это объем продукции по заказам на основании прошлых периодов, очищенный от акционных приростов + плановый прирост по акциям за текущий период.

Прогнозируемый объем по заказам на основании прошлых периодов - это **исходное** количество из документов «Заказ клиента», взятое на каждую дату из периода сбора статистики. Данный объем очищается от акционных приростов за прошлый период. Очищенный объем по всем периодам сбора статистики дополняется плановым приростом по акциям за текущий период из регистра «Акционные отгрузки».

В расчете прогноза не участвуют номенклатуры, выведенные из ассортимента, у которых дата вывода из ассортимента больше периода планирования или равна ему.

Формула расчета прогноза:

`Прогноз = (Очищенный объем за первый период расчета статистики + Очищенный объем за второй период расчета статистики + ... + Очищенный объем за n-ый период расчета статистики)  / Длительность периода статистики из "Правила расчета отгрузок" + Акционный прирост за текущий период планирования`

`Очищенный объем за период расчета статистики = Продажи за период расчета статистики - Акционный прирост за период расчета статистики`

`Количество периодов (n) равно длительности периода статистики из "Правила расчета отгрузок"`

Периоды для расчета статистики формируются исходя из даты, на которую необходимо получить расчет прогноза и длительности 
периода статистики. Если для планирования выбрана периодичность "Неделя" или "Месяц", то периоды будут сформированы, как n предыдущих недель/месяцев.
Если в правиле не указана длительность, то по умолчанию расчет прогноза будет осуществлен для 3 периодов.

Например:

- В сценарии указана периодичность "День", план потребностей необходимо получить на 03.05.25.

[![5][5]][5]

В правилах для расчета статистики указано 3 периода. Исходя из даты отгрузки и количества периодов, определим, за какие периоды будет собираться статистика по заказам и акционным приростам: 3 мая 2025 является субботой, тогда периоды будут выбраны, как предыдущие 3 субботы - 26.04.25, 19.04.25, 12.04.25.

[![6][6]][6] 

- В сценарии указана периодичность "Неделя", план потребностей необходимо получить на неделю с 03.05.25 до 09.05.25.

[![7][7]][7]

В правилах для расчета статистики указано 3 периода. Исходя из периода отгрузки и количества периодов, определим, за какие периоды будет собираться статистика по заказам и акционным приростам: так как периодичность "Неделя", периоды будут выбраны, как 3 предыдущие недели - с 26.04.25 по 02.04.25, с 19.04.25 по 25.04.25, с 12.04.25 по 18.04.25.

[![8][8]][8] 

Рассмотрим *пример расчета прогноза* на 03.05.25 для номенклатуры "Ассорти из мяса цыплят-бройлеров /подложка/" и "Ассорти из мяса цыплят-бройлеров /подложка/ зам.", периодичность планирования - "День", количество периодов для расчета статистики - 3. Как уже было описано ранее, периоды для расчета прогноза будут выбраны, как предыдущие 3 субботы - 26.04.25, 19.04.25, 12.04.25.

Тогда очищенный объем за все периоды расчета статистики будет равен `Объем заказов за 26.04.25 - Акционный прирост за 26.04.25 + Объем заказов за 19.04.25 - Акционный прирост за 19.04.25 + Объем заказов за 12.04.25 - Акционный прирост за 12.04.25`. А прогноз будет равен `Очищенный объем за все периоды расчета статистики / 3 + Плановый акционный прирост за текущий период 03.05.25`.

Объем заказов за 26.04.25 будет взят из колонки "Количество исходный заказ" из регистра "Заказы клиентов".

[![9][9]][9] 

Акционный прирост за 26.04.25 будет взят из колонки "Количество прирост" из регистра "Акционные отгрузки".

[![10][10]][10]

Объем заказов за 19.04.25 будет взят из колонки "Количество исходный заказ" из регистра "Заказы клиентов".

[![11][11]][11] 

Акционный прирост за 19.04.25 будет взят из колонки "Количество прирост" из регистра "Акционные отгрузки".

[![12][12]][12]

Объем заказов за 12.04.25 будет взят из колонки "Количество исходный заказ" из регистра "Заказы клиентов".

[![13][13]][13] 

Акционный прирост за 12.04.25 будет взят из колонки "Количество прирост" из регистра "Акционные отгрузки".

[![14][14]][14]

Плановый акционный прирост за текущий период 03.05.25 будет взят из колонки "Количество прирост" из регистра "Акционные отгрузки".

[![15][15]][15]

По обоим номенклатурам в заказах и акционных отгрузках совпадает характеристика, точка доставки, контрагент, склад и волна отгрузки.

Очищенный объем за все периоды расчета статистики для номенклатуры "Ассорти из мяса цыплят-бройлеров /подложка/" будет равен `2500 - 459,77 + 3000 - 459,77 + 2000 - 459,77 = 6 120,69`. Тогда прогноз будет равен `Очищенный объем за все периоды расчета статистики / 3 + Плановый акционный прирост за текущий период 03.05.25 = 6 120,69 / 3 + 1989,60 = 4 029,83`.

Очищенный объем за все периоды расчета статистики для номенклатуры "Ассорти из мяса цыплят-бройлеров /подложка/ зам." будет равен `3500 - 919,54 + 4000 - 919,54 + 3000 - 919,54  = 7 741,38`. Тогда прогноз будет равен `Очищенный объем за все периоды расчета статистики / 3 + Плановый акционный прирост за текущий период 03.05.25 = 7 741,38 / 3 + 1989,60 = 4 570,06`.

[![16][16]][16]

--------------------------------  

Заполнить план потребностей можно несколькими способами, выбрав из выпадающего списка **Сделать** один из вариантов:

- Заполнить план по правилу – план заполняется по правилам расчета отгрузок, указанных в [**применении правил расчета отгрузок**](RulesForCalculatingShipments.md);
- Заполнить план по сохраненному плану – план заполняется по текущему сохраненному плану;
- Заполнить план по прогнозу отгрузки - план заполняется на основании данных из прогноза отгрузок;
- Заполнить план по прогнозу - план заполняется на основании рассчитанного прогноза;
- Заполнить план по предварительным заказам - план заполняется по предварительным заказам;
- Заполнить план по заказам - план заполняется по фактическим заказам от клиента.

[![17][17]][17]

Есть возможность изменить план вручную:

- Изменить план на процент – план увеличивается на указанный пользователем процент; 
- Округлить план до кратности – план округляется кратно числу, введенному пользователем;
- Установить конкретное значение – план заполняется конкретным значением, которое заполнил пользователь.

[![18][18]][18]

Также доступен выбор периодов, на которые нужно заполнить план:

- Всех – план заполнится для всех периодов планирования;
- Текущего – план заполнится для периода планирования, в котором выделена ячейка;
- Выбранных – план заполнится для периодов планирования, выбранных в поле.

[![19][19]][19]

Для заполнения плана потребностей по выбранному способу необходимо отметить нужные строки и нажать на кнопку **"Выполнить"**. Получившийся план будет автоматически округлен вверх по кратности, указанной в карточке номенклатуры.

[![20][20]][20]

По каждому значению доступен просмотр расшифровки, для этого необходимо выбрать ячейку плана по дате выпуска в нужном периоде:

- Период, номенклатура и характеристика заполняются автоматически в соответствии с выбранной ячейкой;
- Правило подтягивается исходя из данных в [**применении правил расчета отгрузок**](RulesForCalculatingShipments.md) в соответствии с товарной категорией, группой планирования и днем из горизонта планирования;
- Кратность подтягивается из карточки номенклатуры;
- План, Пр-з отгрузки, Прогноз, Пред. Заказ и Заказ подтягиваются для выбранной строки из соответствующих колонок;
- Сумма по правилам – это неокругленная по кратности сумма, полученная по правилу расчета отгрузок;
- Сохраненный план – это количество по текущему сохраненному плану потребностей;
- Продажи БП –  исходное количество по заказам прошлого периода (период для расчета статистики);
- Акции БП –  прирост по акциям в прошлый период (период для расчета статистики);
- План без акции и очищенные отгрузки – количество по заказам прошлого периода, очищенное от акционного прироста и деленное на количество периодов для расчета статистики;
- Акции ПП - прирост по акциям в текущем периоде;
- Средние отгрузки - исходное количество по заказам прошлого периода, деленное на количество периодов для расчета статистики.

[![21][21]][21]

После заполнения плана на вкладке **"Расчет"** будут показаны данные, по которым производился расчет планируемых отгрузок.

[![22][22]][22]

Для сохранения плана отгрузок и формирования документа нужно нажать на кнопку **"Сохранить"**, система автоматически подставит созданный документ в поле "Сохраненный план". Если нам необходимо изменить уже существующий план, то выбираем документ из списка в поле "Сохраненный план", вносим изменения и также нажимаем кнопку **"Сохранить"**.

[![23][23]][23]

В результате сформируется документ **"План потребностей"** на указанный период.

[![24][24]][24]

Если в системе создается несколько документов **"План потребностей"**, то они вытесняют друг друга в рамках одинакового периода и товарной категории. Например, в системе уже сохранен *План потребностей 1* на период с 01.01 по 10.01 по сценарию "Натуральная продукция (недельный сценарий)" по товарной категории "Натуральная продукция", если мы создаем новый план потребностей на период с 08.01 по 10.01 по сценарию "Натуральная продукция (оперативный сценарий)" по товарной категории "Натуральная продукция", то созданный нами план вытеснит данные из старого в периоде с 08.01 по 10.01. Вытеснение означает, что совпадающие значения по дате отгрузки предыдущего документа перестают быть актуальными.

---------------------------------------

В АРМе **"Планирование потребностей"** реализована возможность открыть отчеты **Прогноз потребностей** и **Статистика отгрузок**, для этого нужно нажать на кнопку **"Перейти"**.

- В отчете **Прогноз потребностей** выводится результат планирования отгрузок,  показаны данные по прогнозу, предварительным и фактическим заказам за выбранный период.

[![25][25]][25]

- Отчет **Статистика отгрузок** позволяет анализировать статистику по заказам за выбранный период и сравнивать насколько изменилось количество в заказе относительно исходного количества.

[![26][26]][26]

[1]: NeedsPlanning.assets/1.png
[2]: NeedsPlanning.assets/2.png
[3]: NeedsPlanning.assets/3.png
[4]: NeedsPlanning.assets/4.png
[5]: NeedsPlanning.assets/5.png
[6]: NeedsPlanning.assets/6.png
[7]: NeedsPlanning.assets/7.png
[8]: NeedsPlanning.assets/8.png
[9]: NeedsPlanning.assets/9.png
[10]: NeedsPlanning.assets/10.png
[11]: NeedsPlanning.assets/11.png
[12]: NeedsPlanning.assets/12.png
[13]: NeedsPlanning.assets/13.png
[14]: NeedsPlanning.assets/14.png
[15]: NeedsPlanning.assets/15.png
[16]: NeedsPlanning.assets/16.png
[17]: NeedsPlanning.assets/17.png
[18]: NeedsPlanning.assets/18.png
[19]: NeedsPlanning.assets/19.png
[20]: NeedsPlanning.assets/20.png
[21]: NeedsPlanning.assets/21.png
[22]: NeedsPlanning.assets/22.png
[23]: NeedsPlanning.assets/23.png
[24]: NeedsPlanning.assets/24.png
[25]: NeedsPlanning.assets/25.png
[26]: NeedsPlanning.assets/26.png